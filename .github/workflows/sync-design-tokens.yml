name: Design tokens

#on:
#  schedule:
#    - cron: "0 8 * * *"

on:
  pull_request:
    types: ['opened', 'edited', 'reopened', 'synchronize']

jobs:
  synchronise:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2.3.5

      - name: Install jq
        run: sudo apt install jq

      - name: Generate json files
        run: |
          JSON=$(curl https://raw.githubusercontent.com/scaleway/design-tokens/main/tokens.json)
          JQ_COLORS_EXTRACT='reduce (.[$theme].shades | to_entries | .[]) as $sentiment ({}; . + {"\($sentiment.key)": (reduce($sentiment.value | to_entries | .[]) as $shade ({}; . + { "\($shade.key)": $shade.value.value })) }) | {"colors": .}'
          echo $JSON | jq --arg theme "dark" $JQ_COLORS_EXTRACT > src/theme/tokens/dark.json
          echo $JSON | jq --arg theme "light" $JQ_COLORS_EXTRACT > src/theme/tokens/light.json

      - name: Compare & Create Pull Request
        uses: peter-evans/create-pull-request@v3
