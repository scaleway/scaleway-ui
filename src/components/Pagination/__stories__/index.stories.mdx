import {
  ArgsTable,
  Canvas,
  Description,
  Meta,
  Story,
} from '@storybook/addon-docs'
import { useState } from 'react'
import Pagination from '..'
import Box from '../../Box'
import Button from '../../Button'
import Placeholder from '../../Placeholder'
import getPageNumbers from '../getPageNumbers'
import ExampleChildren from './ExampleChildren'

<Meta title="Components/Pagination" component={Pagination} />

# Pagination

<Description>Pagination can be useful for small info messsages</Description>

<Canvas>
  <Story name="Basic">
    <Pagination
      perPage={5}
      initialData={Array.from({ length: 50 }, (_, index) => index).map(
        value => `Item ${value}`,
      )}
    >
      {({ pageData }) => (
        <ul>
          {pageData.map(item => (
            <li key={item}>{item}</li>
          ))}
        </ul>
      )}
    </Pagination>
  </Story>
</Canvas>

## Functional Children

<Canvas>
  <Story name="Functional">
    <Pagination
      perPage={5}
      initialData={Array.from({ length: 50 }, (_, index) => index).map(
        value => `Item ${value}`,
      )}
    >
      {({ pageData }) => (
        <ul>
          {pageData.map(item => (
            <li key={item}>{item}</li>
          ))}
        </ul>
      )}
    </Pagination>
  </Story>
</Canvas>

## React Component Children

<Canvas>
  <Story name="Component">
    <Pagination
      perPage={5}
      initialData={Array.from({ length: 50 }, (_, index) => index).map(
        value => `Item ${value}`,
      )}
    >
      <ExampleChildren />
    </Pagination>
  </Story>
</Canvas>

## More Page Buttons

<Canvas>
  <Story name="More Page Buttons">
    <Pagination
      pageTabCount={8}
      perPage={3}
      initialData={Array.from({ length: 50 }, (_, index) => index).map(
        value => `Item ${value}`,
      )}
    >
      <ExampleChildren />
    </Pagination>
  </Story>
</Canvas>

## Loadable next page

<Canvas>
  <Story name="Loadable">
    {() => {
      const [fakeLoadNum, setFakeLoadNum] = useState(0)
      const loadMore = async ({ page, perPage }) => {
        const additionalData = Array.from(
          { length: perPage },
          (_, index) => index,
        ).map(value => `Item ${page * perPage + value}`)
        return new Promise(resolve => {
          setTimeout(() => {
            resolve(fakeLoadNum > 3 ? undefined : additionalData)
            setFakeLoadNum(current => current + 1)
          }, 3000)
        })
      }
      return (
        <Pagination
          perPage={5}
          onLoadPage={loadMore}
          initialData={Array.from({ length: 50 }, (_, index) => index).map(
            value => `Item ${value}`,
          )}
          canLoadMore={fakeLoadNum < 3}
        >
          <ExampleChildren />
        </Pagination>
      )
    }}
  </Story>
</Canvas>

## Page Count

<Canvas>
  <Story name="Page Count">
    {() => {
      const loadMore = async ({ page, perPage }) => {
        const additionalData = Array.from(
          { length: perPage },
          (_, index) => index,
        ).map(value => `Item ${page * perPage + value}`)
        return new Promise(resolve => {
          setTimeout(() => {
            resolve(additionalData)
          }, 3000)
        })
      }
      return (
        <Pagination
          perPage={5}
          pageCount={20}
          onLoadPage={loadMore}
          initialData={Array.from({ length: 50 }, (_, index) => index).map(
            value => `Item ${value}`,
          )}
        >
          <ExampleChildren />
        </Pagination>
      )
    }}
  </Story>
</Canvas>

## Custom Components

<Canvas>
  <Story name="Custom">
    {() => {
      const [fakeLoadNum, setFakeLoadNum] = useState(0)
      const loadMore = async ({ page, perPage }) => {
        const additionalData = Array.from(
          { length: perPage },
          (_, index) => index,
        ).map(value => `Item ${page * perPage + value}`)
        return new Promise(resolve => {
          setTimeout(() => {
            resolve(fakeLoadNum > 3 ? undefined : additionalData)
            setFakeLoadNum(current => current + 1)
          }, 3000)
        })
      }
      return (
        <Pagination
          perPage={5}
          onLoadPage={loadMore}
          initialData={Array.from({ length: 50 }, (_, index) => index).map(
            value => `Item ${value}`,
          )}
          canLoadMore={fakeLoadNum < 3}
          LoaderComponent={() => (
            <Box my={2} display="flex" flexDirection="column">
              {Array.from({ length: 5 }, (_, index) => index).map(value => (
                <Placeholder my={1} key={value} variant="line" />
              ))}
            </Box>
          )}
          RightComponent={() => "I'm a custom right component"}
          LeftComponent={() => "I'm a custom left component"}
          MiddleComponent={({
            isLoadingPage,
            page,
            maxPage,
            canLoadMore,
            goToNextPage,
            goToPage,
            goToPreviousPage,
          }) => {
            const pageNumbersToDisplay = getPageNumbers(page, maxPage, 5)
            const handlePageClick = pageNumber => () => {
              goToPage(pageNumber)
            }
            return (
              <>
                <Button
                  mr={1}
                  disabled={page === 1 || isLoadingPage}
                  onClick={goToPreviousPage}
                >
                  Back
                </Button>
                {pageNumbersToDisplay.map(pageNumber => (
                  <Button
                    key={pageNumber}
                    mr={1}
                    disabled={isLoadingPage}
                    variant={page === pageNumber ? 'primary' : 'secondary'}
                    onClick={handlePageClick(pageNumber)}
                  >
                    {pageNumber}
                  </Button>
                ))}
                <Button
                  mr={1}
                  disabled={(page === maxPage && !canLoadMore) || isLoadingPage}
                  onClick={goToNextPage}
                >
                  Next
                </Button>
              </>
            )
          }}
        >
          <ExampleChildren />
        </Pagination>
      )
    }}
  </Story>
</Canvas>

## API

<ArgsTable of={Pagination} />
