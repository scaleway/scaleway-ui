import {
  ArgsTable,
  Canvas,
  Description,
  Meta,
  Story,
} from '@storybook/addon-docs/blocks'
import { useEffect, useState } from 'react'
import RichSelect from '..'
import { ActivityIndicator, Badge, Box, Button } from '../..'
import ControlValue from '../../../__stories__/components/ControlValue'
import * as animations from '../../../utils/animations'

<Meta title="Components/RichSelect" component={RichSelect} />

# RichSelect

<Description>
  RichSelect is a component used to select a value between different options.
</Description>

## Basic

### Uncontrolled

<Canvas>
  <Story name="Uncontrolled" height="175px">
    <Box m={2}>
      <RichSelect
        isClearable
        disabled
        name="uncontrolled"
        value={{ label: 'Option A', value: 'a' }}
      >
        <RichSelect.Option value="a">Option A</RichSelect.Option>
        <RichSelect.Option value="b">Option B</RichSelect.Option>
      </RichSelect>
    </Box>
  </Story>
</Canvas>

### Controlled

<Canvas>
  <Story name="Controlled" height="175px">
    <Box m={2}>
      <ControlValue value="">
        {({ value, onChange }) => (
          <RichSelect name="controlled" value={value} onChange={onChange}>
            <RichSelect.Option value="a">Option A</RichSelect.Option>
            <RichSelect.Option value="b">Option B</RichSelect.Option>
          </RichSelect>
        )}
      </ControlValue>
    </Box>
  </Story>
</Canvas>

### Custom Option

<Description>
  You can customize options in a RichSelect by adding component inside of it.
  Here we added a Badge inside of option B.
</Description>

<Canvas>
  <Story name="Custom Option" height="175px">
    <Box m={2}>
      <RichSelect name="disabled">
        <RichSelect.Option value="a">Option A</RichSelect.Option>
        <RichSelect.Option value="b">
          <Box display="flex" alignItems="center">
            Option B
            <Badge size="rounded" ml={1}>
              Awesome badge
            </Badge>
          </Box>
        </RichSelect.Option>
      </RichSelect>
    </Box>
  </Story>
</Canvas>

### No Label

<Canvas>
  <Story name="No Label" height="175px">
    <Box m={2}>
      <RichSelect name="label" noTopLabel>
        <RichSelect.Option value="a">Option A</RichSelect.Option>
        <RichSelect.Option value="b">Option B</RichSelect.Option>
      </RichSelect>
    </Box>
  </Story>
</Canvas>

### Searchable

<Canvas>
  <Story name="Searchable" height="175px">
    <Box m={2}>
      <RichSelect name="searchable" isSearchable>
        <RichSelect.Option value="a">Option A</RichSelect.Option>
        <RichSelect.Option value="b">Option B</RichSelect.Option>
      </RichSelect>
    </Box>
  </Story>
</Canvas>

### Required

<Canvas>
  <Story name="Required" height="175px">
    <Box m={2}>
      <RichSelect name="required" required>
        <RichSelect.Option value="a">Option A</RichSelect.Option>
        <RichSelect.Option value="b">Option B</RichSelect.Option>
      </RichSelect>
    </Box>
  </Story>
</Canvas>

### Disabled

<Canvas>
  <Story name="Disabled" height="100px">
    <Box m={2}>
      <RichSelect name="disabled" disabled value="a">
        <RichSelect.Option value="a">Option A</RichSelect.Option>
        <RichSelect.Option value="b">Option B</RichSelect.Option>
      </RichSelect>
    </Box>
  </Story>
</Canvas>

### Option Disabled

<Canvas>
  <Story name="Option Disabled" height="175px">
    <Box m={2}>
      <RichSelect inputId="test" labelId="test-label" name="option-disabled">
        <RichSelect.Option value="a">Option A</RichSelect.Option>
        <RichSelect.Option value="b" disabled>
          Option B
        </RichSelect.Option>
      </RichSelect>
    </Box>
  </Story>
</Canvas>

### Animated

#### Description

You can easily add an animation to your RichSelect using `animationOnChange`, `animation` and `animationDuration` properties.<br/>
The animation will be played when the value changes. Animation start when you select new value but also if you change the value
of RichSelect with an external way (check example with button).

#### Available animations

<ControlValue>
  {() => (
    <Box>
      {Object.keys(animations).map(animation => (
        <code key={animation}>{animation}</code>
      ))}
    </Box>
  )}
</ControlValue>

<Canvas>
  <Story name="Animated" height="400px">
    <Box mx={8} my={2}>
      <ControlValue value="">
        {({ value, onChange }) => {
          const [options] = useState(
            Object.keys(animations).map(animation => ({
              label: animation,
              value: animation,
            })),
          )
          return (
            <>
              <Button
                onClick={() => onChange({ label: 'pulse', value: 'pulse' })}
                mb={4}
              >
                Select pulse animation
              </Button>
              <RichSelect
                name="animated"
                animationOnChange
                animation={value.value}
                animationDuration={1000}
                value={value}
                onChange={onChange}
                options={options}
              />
            </>
          )
        }}
      </ControlValue>
    </Box>
  </Story>
</Canvas>

## Multi

### Normal

<Canvas>
  <Story name="Multi" height="300px">
    <Box m={2}>
      <RichSelect name="multi" isMulti>
        <RichSelect.Option value="a">Option A</RichSelect.Option>
        <RichSelect.Option value="b">Option B</RichSelect.Option>
        <RichSelect.Option value="c">Option C</RichSelect.Option>
        <RichSelect.Option value="d">Option D</RichSelect.Option>
        <RichSelect.Option value="e">Option E</RichSelect.Option>
        <RichSelect.Option value="f">Option F</RichSelect.Option>
      </RichSelect>
    </Box>
  </Story>
</Canvas>

### Disabled

<Canvas>
  <Story name="Multi Disabled" height="100px">
    <Box m={2}>
      <RichSelect
        name="multi-disabled"
        value={{ label: 'Option A', value: 'a' }}
        isMulti
        disabled
      >
        <RichSelect.Option value="a">Option A</RichSelect.Option>
        <RichSelect.Option value="b">Option B</RichSelect.Option>
      </RichSelect>
    </Box>
  </Story>
</Canvas>

## Time

### Normal

<Canvas>
  <Story name="Time" height="175px">
    <Box m={2}>
      <RichSelect name="time" time>
        <RichSelect.Option value="11">11:00</RichSelect.Option>
        <RichSelect.Option value="12">12:00</RichSelect.Option>
      </RichSelect>
    </Box>
  </Story>
</Canvas>

### Error

<Canvas>
  <Story name="Time Error" height="175px">
    <Box m={2}>
      <RichSelect name="time-error" time error>
        <RichSelect.Option value="11">11:00</RichSelect.Option>
        <RichSelect.Option value="12">12:00</RichSelect.Option>
      </RichSelect>
    </Box>
  </Story>
</Canvas>

## Loading

### Demo

<Canvas>
  <Story name="Demo Loading" height="175px">
    <Box>
      <RichSelect name="loading" isLoading>
        <RichSelect.Option value="a">Option A</RichSelect.Option>
        <RichSelect.Option value="b">Option B</RichSelect.Option>
      </RichSelect>
    </Box>
  </Story>
</Canvas>

### Example

<Canvas>
  <Story name="Exemple with custom LoadingIndicator" height="175px">
    {() => {
      const [isLoading, setIsLoading] = useState(true)
      useEffect(() => {
        let timeout
        if (isLoading) {
          timeout = setTimeout(() => {
            setIsLoading(false)
          }, 3000)
        }
        return () => clearTimeout(timeout)
      }, [isLoading])
      return (
        <Box>
          <Button size="small" mb={2} onClick={() => setIsLoading(true)}>
            Load data
          </Button>
          <RichSelect
            name="exemple"
            isLoading={isLoading}
            customComponents={{
              LoadingIndicator: () => <ActivityIndicator active size={24} />,
            }}
          >
            <RichSelect.Option value="a">Option A</RichSelect.Option>
            {!isLoading && (
              <RichSelect.Option value="b">Option B</RichSelect.Option>
            )}
          </RichSelect>
        </Box>
      )
    }}
  </Story>
</Canvas>

## Known issues

### RichSelect doesn't keep focus on selected option

<Description>
  RichSelect is based on the `react-select` library. To keep the focus on the
  selected option you need to use `options` prop with a memoized value or a
  memoized `children`
</Description>

## Properties

<ArgsTable of={RichSelect} />
